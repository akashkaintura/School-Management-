<div class="subject-management-container">
    <div class="header">
        <div class="header-left">
            <h1>üìö Subject Management</h1>
            <p>Create and manage subjects for your school</p>
        </div>
        <button class="btn btn-primary" (click)="openCreateModal()">
            + Add Subject
        </button>
    </div>

    <!-- Message Alert -->
    <div *ngIf="message" class="alert" [class.alert-success]="messageType === 'success'"
        [class.alert-error]="messageType === 'error'">
        {{ message }}
    </div>

    <!-- Filters -->
    <div class="filters">
        <div class="filter-group">
            <label>Filter by Board:</label>
            <select [(ngModel)]="selectedBoardFilter" (change)="filterByBoard()" class="filter-select">
                <option value="">All Boards</option>
                <option *ngFor="let board of boards" [value]="board">{{ board }}</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Search:</label>
            <input type="text" [(ngModel)]="searchTerm" placeholder="Search by name or code..." class="search-input">
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading subjects...</p>
    </div>

    <!-- Subjects Table -->
    <div *ngIf="!loading" class="table-container">
        <table class="subjects-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Code</th>
                    <th>Board</th>
                    <th>Description</th>
                    <th>Classes</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let subject of filteredSubjects">
                    <td>{{ subject.name }}</td>
                    <td><span class="code-badge">{{ subject.code }}</span></td>
                    <td><span class="board-badge">{{ subject.board || 'N/A' }}</span></td>
                    <td>{{ subject.description || '-' }}</td>
                    <td>
                        <span class="class-count">{{ subject.classSubjects?.length || 0 }} classes</span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit" (click)="openEditModal(subject)" title="Edit">
                                ‚úèÔ∏è
                            </button>
                            <button class="btn-icon btn-assign" (click)="openAssignModal(subject)"
                                title="Assign to Class">
                                üìå
                            </button>
                            <button class="btn-icon btn-delete" (click)="openDeleteModal(subject.id)" title="Delete">
                                üóëÔ∏è
                            </button>
                        </div>
                    </td>
                </tr>
                <tr *ngIf="filteredSubjects.length === 0">
                    <td colspan="6" class="no-data">No subjects found</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Create Subject Modal -->
    <div *ngIf="showCreateModal" class="modal-overlay" (click)="closeCreateModal()">
        <div class="modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Create New Subject</h2>
                <button class="close-btn" (click)="closeCreateModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Subject Name *</label>
                    <input type="text" [(ngModel)]="createForm.name" placeholder="e.g., Mathematics">
                </div>
                <div class="form-group">
                    <label>Subject Code *</label>
                    <input type="text" [(ngModel)]="createForm.code" placeholder="e.g., MATH">
                </div>
                <div class="form-group">
                    <label>Board</label>
                    <select [(ngModel)]="createForm.board">
                        <option value="">Select Board</option>
                        <option *ngFor="let board of boards" [value]="board">{{ board }}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea [(ngModel)]="createForm.description" rows="3"
                        placeholder="Optional description"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" (click)="closeCreateModal()">Cancel</button>
                <button class="btn btn-primary" (click)="createSubject()">Create Subject</button>
            </div>
        </div>
    </div>

    <!-- Edit Subject Modal -->
    <div *ngIf="showEditModal" class="modal-overlay" (click)="closeEditModal()">
        <div class="modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Edit Subject</h2>
                <button class="close-btn" (click)="closeEditModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Subject Name *</label>
                    <input type="text" [(ngModel)]="editForm.name">
                </div>
                <div class="form-group">
                    <label>Subject Code *</label>
                    <input type="text" [(ngModel)]="editForm.code">
                </div>
                <div class="form-group">
                    <label>Board</label>
                    <select [(ngModel)]="editForm.board">
                        <option value="">Select Board</option>
                        <option *ngFor="let board of boards" [value]="board">{{ board }}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea [(ngModel)]="editForm.description" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
                <button class="btn btn-primary" (click)="updateSubject()">Update Subject</button>
            </div>
        </div>
    </div>

    <!-- Assign to Class Modal -->
    <div *ngIf="showAssignModal" class="modal-overlay" (click)="closeAssignModal()">
        <div class="modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Assign Subject to Class</h2>
                <button class="close-btn" (click)="closeAssignModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="subject-info">
                    <strong>Subject:</strong> {{ selectedSubject?.name }} ({{ selectedSubject?.code }})
                </div>
                <div class="form-group">
                    <label>Select Class *</label>
                    <select [(ngModel)]="assignForm.classId">
                        <option value="">Choose a class</option>
                        <option *ngFor="let class of classes" [value]="class.id">
                            {{ class.name }} - {{ class.section }}
                        </option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Select Teacher *</label>
                    <select [(ngModel)]="assignForm.teacherId">
                        <option value="">Choose a teacher</option>
                        <option *ngFor="let teacher of teachers" [value]="teacher.id">
                            {{ teacher.user?.profile?.firstName }} {{ teacher.user?.profile?.lastName }}
                        </option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" (click)="closeAssignModal()">Cancel</button>
                <button class="btn btn-primary" (click)="assignToClass()">Assign</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div *ngIf="showDeleteModal" class="modal-overlay" (click)="closeDeleteModal()">
        <div class="modal modal-small" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Confirm Delete</h2>
                <button class="close-btn" (click)="closeDeleteModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this subject? This action cannot be undone.</p>
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Warning:</strong> All class assignments for this subject will also be removed.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
                <button class="btn btn-danger" (click)="deleteSubject()">Delete</button>
            </div>
        </div>
    </div>
</div>